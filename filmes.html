<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filmes</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <style>
        body {
            background-color: black;
            color: white;
        }
    </style>
</head>
<body>
    <div class="bg-black text-white min-h-screen p-4">
        <header class="flex items-center justify-between mb-4">
            <div class="flex items-center">
                <h1 class="text-2xl font-bold ml-4">filmes e séries aleatórios</h1>
            </div>
        </header>
        <div id="movie-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <!-- Filmes vão ser carregados aqui -->
        </div>
    </div>

    <script>
        let currentPage = 2; // Começa da página 2
        let isLoading = false; // Controla se o carregamento está em progresso
        let hasMoreMovies = true; // Controla se há mais filmes para carregar

        async function loadMovies(page) {
            if (isLoading || !hasMoreMovies) return; // Evita múltiplos carregamentos simultâneos e carregamento sem necessidade
            isLoading = true;

            const url = `https://api.baserow.io/api/database/rows/table/228337/?user_field_names=true&order_by=-Data&size=100&page=${page}&filter__field_2335839__contains=`;
            const token = '642C9lnOkgh3JF5XELTe687eQtSphPXh';

            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': `Token ${token}`,
                    'Accept-Encoding': 'gzip',
                }
            });

            const data = await response.json();

            const movieGrid = document.getElementById('movie-grid');

            // Se não houver mais filmes, interrompe o carregamento
            if (data.results.length === 0) {
                hasMoreMovies = false;
                isLoading = false;
                return;
            }

            data.results.forEach(movie => {
                const movieElement = document.createElement('div');
                movieElement.className = 'text-center';
                movieElement.innerHTML = `
                    <a href="${movie.Link}" download>
                        <img src="${movie.Capa}" alt="${movie.Nome}" class="w-full h-auto" style="aspect-ratio: 100 / 150; object-fit: cover;" />
                    </a>
                    <p class="mt-2 text-sm truncate">${movie.Nome}</p>
                `;
                movieGrid.appendChild(movieElement);
            });

            isLoading = false;
        }

        // Função para verificar se o usuário chegou ao final da página
        function handleScroll() {
            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
                loadMovies(currentPage);
                currentPage++;
            }
        }

        // Adiciona o evento de scroll para carregar mais filmes
        window.addEventListener('scroll', handleScroll);

        // Carregar a primeira página ao iniciar
        loadMovies(2);
    </script>
</body>
</html>
